// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

enum ApplicationStatus {
  APPLIED
  SHORTLISTED
  NEXT_ROUND_REQUESTED
  NEXT_ROUND_ACCEPTED
  NEXT_ROUND_REJECTED
  INTERVIEW_SCHEDULED
  INTERVIEW_ACCEPTED
  HIRED
  REJECTED
}

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum AuthRoles {
  USER
  INSTITUTE
}

enum UserRoles {
  DOCTOR
  NURSE
  OTHER
  STUDENT
}

enum InstituteRoles {
  HOSPITAL
  CLINIC
  LAB
  PHARMACY
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

model Auth {
  id         Int       @id @default(autoincrement())
  created_at DateTime  @default(now())
  email      String    @unique
  password   String
  role       AuthRoles @default(USER)
}

model User {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())

  firstName      String
  lastName       String
  email          String        @unique
  password       String
  country        String        @default("India")
  city           String        @default("")
  university     String?
  degree         String?
  yearOfStudy    String?
  verified       Boolean       @default(false)
  gender         String?
  specialization String?
  speciality     String?
  subSpeciality  String?
  role           UserRoles     @default(STUDENT)
  experience     Int?
  JobApplication Application[]

  headline String?
  about    String?

  savedJobs         SavedJob[]
  userImages        UserImages[]
  userExperiences   UserExperiences[]
  userEducations    UserEducation[]
  skills            UserSkills[]
  userSpecialities  UserSpecialities[]
  userLinks         UserLinks[]
  userVerifications UserVerifications[]
  conversations     Conversation[]
}

model Institute {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())

  name          String   @unique
  country       String?
  city          String?
  verified      Boolean  @default(false)
  contactEmail  String   @unique
  password      String
  contactNumber String
  bedsCount     Int
  staffCount    Int
  type          String
  services      String[]
  telephone     String

  role InstituteRoles @default(HOSPITAL)

  Job Job[]

  affiliatedUniversity    String?
  yearEstablished         Int?
  ownership               String?
  headline                String?
  about                   String?
  instituteCreditsWallets InstituteCredits[]
  instituteViews          InstituteView[]
  instituteImages         InstituteImages[]
  instituteVerifications  InstituteVerifications[]
  conversations           Conversation[]
}

model InstituteCredits {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  credits     Int        @default(0)
  institute   Institute? @relation(fields: [instituteId], references: [id])
  instituteId String?
}

model CreditsWallet {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  newJobCreditsPrice   Int @default(0)
  renewJobCreditsPrice Int @default(0)
}

model Job {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  title            String
  jobType          String
  role             String
  skills           String[]
  workLocation     String
  city             String?
  country          String?
  experienceLevel  String
  shortDescription String?

  fullDescription String
  requirements    String
  additionalInfo  String?

  salaryCurrency      String?   @default("INR")
  salaryMin           Int
  salaryMax           Int
  applicationDeadline DateTime?
  contactEmail        String?
  contactPhone        String?
  contactPerson       String?

  status      String    @default("active")
  institute   Institute @relation(fields: [instituteId], references: [id], onDelete: Cascade)
  instituteId String

  speciality    String? @default("")
  subSpeciality String? @default("")

  applications  Application[]
  JobView       JobView[]
  savedJobs     SavedJob[]
  renewedAt     DateTime?
  notifications Notification[]
}

model Application {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  status      ApplicationStatus @default(APPLIED)
  appliedDate DateTime          @default(now())
  resumeUrl   String

  coverLetter       String?
  experienceYears   Int?
  currentPosition   String?
  currentInstitute  String?
  additionalDetails Json?

  job           Job            @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobId         String
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String
  notifications Notification[]
}

model JobView {
  id       String   @id @default(uuid())
  jobId    String
  userId   String?
  viewedAt DateTime @default(now())

  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model InstituteView {
  id          String   @id @default(uuid())
  instituteId String
  userId      String?
  viewedAt    DateTime @default(now())

  institute Institute @relation(fields: [instituteId], references: [id], onDelete: Cascade)

  @@unique([instituteId, userId])
}

model InstituteImages {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  instituteId  String @default("")
  coverImage   String @default("")
  profileImage String @default("")

  institute Institute @relation(fields: [instituteId], references: [id], onDelete: Cascade)
}

model UserImages {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  userId       String @default("")
  coverImage   String @default("")
  profileImage String @default("")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SavedJob {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  job    Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobId  String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String
}

model Notification {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  receiverId   String
  receiverRole String
  title        String
  message      String
  isRead       Boolean @default(false)

  relatedJobId         String?
  relatedApplicationId String?
  status               ApplicationStatus?

  job         Job?         @relation(fields: [relatedJobId], references: [id])
  application Application? @relation(fields: [relatedApplicationId], references: [id])
}

model UserExperiences {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  userId           String   @default("")
  organizationName String   @default("")
  role             String   @default("")
  startDate        DateTime @default(now())
  endDate          DateTime @default(now())
  description      String   @default("")
  locationType     String   @default("")
  country          String   @default("")
  city             String   @default("")
  isCurrentJob     Boolean  @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserEducation {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  userId        String   @default("")
  instituteName String   @default("")
  degree        String   @default("")
  startDate     DateTime @default(now())
  endDate       DateTime @default(now())
  country       String   @default("")
  city          String   @default("")
  isCurrentJob  Boolean  @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserSkills {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  userId String   @default("")
  skills String[] @default([])

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserSpecialities {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  userId       String   @default("")
  specialities String[] @default([])

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserLinks {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  userId String   @default("")
  links  String[] @default([])

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserVerifications {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user     User      @relation(fields: [userId], references: [id])
  userId   String
  userRole UserRoles

  status VerificationStatus @default(PENDING)

  firstName         String
  lastName          String
  dob               DateTime
  governMentId      String
  authorizeToVerify Boolean
  email             String
  phone             String
  country           String
  city              String

  professionalTitle             String
  primarySpecialty              String
  licenseNumber                 String
  licenseExpiryDate             DateTime
  degree                        String
  university                    String
  yearOfGraduation              DateTime
  degreeCertificate             String
  postGraduateDegree            String?
  postGraduateUniversity        String?
  postGraduateDegreeCertificate String?

  currentEmployer String?
  currentRole     String?
  practiceCountry String?
  practiceCity    String?

  isLicenceSuspended      Boolean @default(false)
  licenceSuspensionReason String?
}

model InstituteVerifications {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  institute   Institute @relation(fields: [instituteId], references: [id])
  instituteId String    @unique

  status VerificationStatus @default(PENDING)

  telephone               String
  email                   String
  adminName               String
  adminPhone              String
  registrationCertificate String
}

enum SenderType {
  USER
  INSTITUTE
}

enum MediaType {
  IMAGE
  VIDEO
  PDF
  VOICE
}

model Conversation {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  institute   Institute @relation(fields: [instituteId], references: [id])
  instituteId String
  user        User      @relation(fields: [userId], references: [id])
  userId      String

  lastMessage   Message? @relation("LastMessage", fields: [lastMessageId], references: [id])
  lastMessageId String?  @unique

  instituteUnreadCount Int @default(0)
  userUnreadCount      Int @default(0)

  messages Message[] @relation("ConversationMessages")

  @@unique([instituteId, userId])
  @@index([instituteId])
  @@index([userId])
}

model Message {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  conversation   Conversation @relation("ConversationMessages", fields: [conversationId], references: [id], onDelete: Cascade)
  conversationId String

  senderType SenderType
  senderId   String

  content   String?
  mediaUrl  String?
  mediaType MediaType?

  isRead Boolean @default(false)

  lastInConversation Conversation? @relation("LastMessage")

  @@index([conversationId])
  @@index([isRead])
}
